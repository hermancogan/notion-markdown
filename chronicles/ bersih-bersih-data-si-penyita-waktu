{   "nodes": [     {       "parameters": {         "pollTimes": {           "item": [             {               "mode": "everyMinute"             }           ]         },         "databaseId": {           "__rl": true,           "value": "feb55cd1-55a0-4976-aeaf-0d6dbc03da47",           "mode": "list",           "cachedResultName": "Capture ",           "cachedResultUrl": "https://www.notion.so/feb55cd155a04976aeaf0d6dbc03da47"         }       },       "type": "n8n-nodes-base.notionTrigger",       "typeVersion": 1,       "position": [         -2128,         -240       ],       "id": "016dbeee-fe15-40f3-80f7-b1e1abc4e300",       "name": "Notion Trigger1",       "credentials": {         "notionApi": {           "id": "gMZYc6YxOKqWc293",           "name": "HaJE Keeps"         }       }     },     {       "parameters": {         "resource": "file",         "owner": {           "__rl": true,           "value": "hermancogan",           "mode": "name"         },         "repository": {           "__rl": true,           "value": "notion-markdown",           "mode": "list",           "cachedResultName": "notion-markdown",           "cachedResultUrl": "https://github.com/hermancogan/notion-markdown"         },         "filePath": "=chronicles/bersih-bersih-data-si-penyita-waktu",         "fileContent": "={
  "metadata": {
    "title": "Bersih Bersih Data, Si Penyita Waktu",
    "page_id": "1b8f2e85-b591-809a-b3a1-f1ca191c4d81",
    "slug": "bersih-bersih-data-si-penyita-waktu",
    "excerpt": "Lalu bentuk penyesuaian yang kamu lakukan seperti apa? Mulai dari menyesuaikan format sesuai standar data, sampai menemukan typo yang memungkinkan menghasilkan data yang kacau.",
    "categories": [
      "Blog"
    ],
    "tags": [
      "blog",
      "Python"
    ],
    "image": "",
    "created_time": "01.51 17-03-25",
    "last_edited_time": "2025-12-27T14:38:00.000Z",
    "url": "https://www.notion.so/bersih-bersih-data-si-penyita-waktu-1b8f2e85b591809ab3a1f1ca191c4d81",
    "author": [
      "Sultan"
    ],
    "contributor": [
      "Goks"
    ]
  },
  "content": "<h3>Kalau disuruh mengolah data yang relatif besar, percayalah itu hanya mengambil sedikit dari waktumu! Ada hal pelik di awal mengolah data.</h3><h3>Bayangkan ada banyak data yang masuk ke pekerjaanmu, dan hampir semua itu tak memenuhi kaidah data berkualitas yang menjadi standarmu. Tentunya perlu penyesuaian lagi kan???</h3><p>Lalu bentuk penyesuaian yang kamu lakukan seperti apa? Mulai dari menyesuaikan format sesuai standar data, sampai menemukan typo yang memungkinkan menghasilkan data yang kacau.</p><p>Prinsip GIGO (Garbage In Garbage Out) sudah sangat familiar di kalangan pengolah data. Data berkarakteristik sampah, akan menghasilkan informasi sampah. Bisa sih dibersihkan dahulu, tapi hasilnya biasanya akan sedikit yang bisa diolah.</p><p>Jadi memastikan data berkualitas yang masuk adalah bentuk penjagaan terhadap informasi yang akan dihasilkan.</p><div>Bersih Bersih Data, Si Penyita Waktu</div>"
}",         "commitMessage": "=Create bersih-bersih-data-si-penyita-waktu via n8n  bby Sultan"       },       "id": "c87c92b6-54e8-4918-8eee-0cea4f3eb572",       "name": "Create GitHub File",       "type": "n8n-nodes-base.github",       "typeVersion": 1,       "position": [         -240,         -176       ],       "webhookId": "da25fe41-aee4-43ad-aafd-9293bcf61aca",       "alwaysOutputData": false,       "notesInFlow": false,       "credentials": {         "githubApi": {           "id": "OsNdQwx2m4F3g7TM",           "name": "GitHub account 2"         }       },       "onError": "continueErrorOutput"     },     {       "parameters": {         "resource": "block",         "operation": "getAll",         "blockId": {           "__rl": true,           "value": "=",           "mode": "id"         },         "returnAll": true,         "fetchNestedBlocks": true       },       "type": "n8n-nodes-base.notion",       "typeVersion": 2.2,       "position": [         -1408,         80       ],       "id": "a3fa95ac-4102-4f78-bb4f-329a355c069f",       "name": "Get Page Blocks",       "credentials": {         "notionApi": {           "id": "gMZYc6YxOKqWc293",           "name": "HaJE Keeps"         }       },       "onError": "continueRegularOutput"     },     {       "parameters": {         "jsCode": "const grouped = {};\n\n// Helper: Safely get text content from a block (handles both .content and .rich_text)\nfunction getTextContent(block, typeKey) {\n  if (typeof block.content === 'string' && block.content.trim() !== '') {\n    return block.content.trim();\n  }\n  const richTextArr = block[typeKey]?.rich_text;\n  if (Array.isArray(richTextArr) && richTextArr.length > 0) {\n    return richTextArr.map(t => t.plain_text || '').join('');\n  }\n  return '';\n}\n\n// Helper: Get image URL (file or external)\nfunction getImageUrl(block) {\n  return (block?.image?.file?.url || block?.image?.external?.url || '').trim();\n}\n\n// Helper: Convert a Notion block to HTML, with override for first paragraph as h3\nfunction blockToHTML(block, opts = {}) {\n  if (!block) return '';\n  let content = '';\n  switch (block.type) {\n    case 'heading_1':\n      content = getTextContent(block, 'heading_1');\n      return content ? `<h1>${content}</h1>` : '';\n    case 'heading_2':\n      content = getTextContent(block, 'heading_2');\n      return content ? `<h2>${content}</h2>` : '';\n    case 'heading_3':\n      content = getTextContent(block, 'heading_3');\n      return content ? `<h3>${content}</h3>` : '';\n    case 'paragraph':\n      content = getTextContent(block, 'paragraph');\n      if (opts.forceH3) {\n        return content ? `<h3>${content}</h3>` : '';\n      }\n      return content ? `<p>${content}</p>` : '';\n    case 'bulleted_list_item':\n      content = getTextContent(block, 'bulleted_list_item');\n      return content ? `<li>${content}</li>` : '';\n    case 'numbered_list_item':\n      content = getTextContent(block, 'numbered_list_item');\n      return content ? `<li>${content}</li>` : '';\n    case 'to_do':\n      content = getTextContent(block, 'to_do');\n      const checked = block.to_do?.checked ? 'checked' : '';\n      return content ? `<div><input type=\"checkbox\" disabled ${checked}/> ${content}</div>` : '';\n    case 'quote':\n      content = getTextContent(block, 'quote');\n      return content ? `<blockquote>${content}</blockquote>` : '';\n    case 'code':\n      content = getTextContent(block, 'code');\n      return content ? `<pre><code>${content}</code></pre>` : '';\n    case 'callout':\n      content = getTextContent(block, 'callout');\n      return content ? `<div class=\"callout\">${content}</div>` : '';\n    case 'image': {\n      const url = getImageUrl(block);\n      return url ? `<img src=\"${url}\" alt=\"\" style=\"max-width:100%;\" />` : '';\n    }\n    case 'divider':\n      return `<hr/>`;\n    default:\n      content = getTextContent(block, block.type);\n      return content ? `<div>${content}</div>` : '';\n  }\n}\n\n// Main grouping logic\nfor (const item of items) {\n  const block = item.json;\n  const pageId = block.parent?.page_id || block.parent_id;\n  if (!pageId) continue;\n  if (!grouped[pageId]) grouped[pageId] = [];\n  grouped[pageId].push(block);\n}\n\n// Post-process: assemble HTML per page, handle lists, force first paragraph to h3, and capture first image\nfunction assembleHTMLAndImage(blocks) {\n  let html = '';\n  let inBulletedList = false;\n  let inNumberedList = false;\n  let firstParagraphDone = false;\n  let firstImageUrl = '';\n\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n\n    // Capture the first image URL (even if we later skip rendering, but we do render)\n    if (!firstImageUrl && block.type === 'image') {\n      const url = getImageUrl(block);\n      if (url) firstImageUrl = url;\n    }\n\n    if (block.type === 'bulleted_list_item') {\n      if (!inBulletedList) { html += '<ul>'; inBulletedList = true; }\n      html += blockToHTML(block);\n    } else if (block.type === 'numbered_list_item') {\n      if (!inNumberedList) { html += '<ol>'; inNumberedList = true; }\n      html += blockToHTML(block);\n    } else {\n      if (inBulletedList) { html += '</ul>'; inBulletedList = false; }\n      if (inNumberedList) { html += '</ol>'; inNumberedList = false; }\n      // Force the first paragraph to h3\n      if (!firstParagraphDone && block.type === 'paragraph') {\n        html += blockToHTML(block, { forceH3: true });\n        firstParagraphDone = true;\n      } else {\n        html += blockToHTML(block);\n      }\n    }\n  }\n  if (inBulletedList) html += '</ul>';\n  if (inNumberedList) html += '</ol>';\n\n  return { html: html.trim(), firstImageUrl };\n}\n\nreturn Object.entries(grouped).map(([page_id, blocks]) => {\n  const { html, firstImageUrl } = assembleHTMLAndImage(blocks);\n  return {\n    json: {\n      page_id,\n      image: firstImageUrl || '',\n      content: html\n    }\n  };\n});\n"       },       "type": "n8n-nodes-base.code",       "typeVersion": 2,       "position": [         -1184,         80       ],       "id": "cbc54746-c796-45bd-91ea-56e7cf142a6f",       "name": "Notion Block Extract",       "alwaysOutputData": false     },     {       "parameters": {         "resource": "databasePage",         "operation": "getAll",         "databaseId": {           "__rl": true,           "value": "feb55cd1-55a0-4976-aeaf-0d6dbc03da47",           "mode": "list",           "cachedResultName": "Capture ",           "cachedResultUrl": "https://www.notion.so/feb55cd155a04976aeaf0d6dbc03da47"         },         "returnAll": true,         "simple": false,         "filterType": "manual",         "matchType": "allFilters",         "filters": {           "conditions": [             {               "key": "status|select",               "condition": "equals",               "selectValue": "published"             },             {               "key": "categories|multi_select",               "condition": "contains",               "multiSelectValue": "Blog"             }           ]         },         "options": {}       },       "type": "n8n-nodes-base.notion",       "typeVersion": 2.2,       "position": [         -1568,         -192       ],       "id": "2370480c-fe38-40a3-9190-ca84bebd2612",       "name": "Get Database Pages",       "credentials": {         "notionApi": {           "id": "gMZYc6YxOKqWc293",           "name": "HaJE Keeps"         }       },       "onError": "continueRegularOutput"     },     {       "parameters": {         "jsCode": "// Outputs one item per input with shape:\n// { metadata: { ... }, content: \"<html>\" }\n\nfunction slugify(str = \"\") {\n  return String(str)\n    .toLowerCase()\n    .normalize(\"NFKD\")\n    .replace(/[^\w\s-]/g, \"\")\n    .trim()\n    .replace(/\s+/g, \"-\")\n    .replace(/-+/g, \"-\");\n}\n\nfunction stripHtml(html = \"\") {\n  return String(html)\n    .replace(/<script[\s\S]*?<\/script>/gi, \"\")\n    .replace(/<style[\s\S]*?<\/style>/gi, \"\")\n    .replace(/<[^>]+>/g, \" \")\n    .replace(/\s+/g, \" \")\n    .trim();\n}\n\nfunction firstParagraphText(html = \"\") {\n  const p = String(html).match(/<p[^>]*>([\s\S]*?)<\/p>/i);\n  return p ? stripHtml(p[1]) : stripHtml(html);\n}\n\n// Format date to \"HH.MM DD-MM-YY\" in GMT+8\nfunction formatDateGMT8(x) {\n  if (!x) return undefined;\n  const d = new Date(x);\n  if (isNaN(d.getTime())) return undefined;\n\n  // Convert to GMT+8\n  const utc = d.getTime() + (d.getTimezoneOffset() * 60000);\n  const gmt8 = new Date(utc + (8 * 60 * 60000));\n\n  const pad = (n) => (n < 10 ? \"0\" + n : n);\n\n  const hours = pad(gmt8.getHours());\n  const minutes = pad(gmt8.getMinutes());\n  const day = pad(gmt8.getDate());\n  const month = pad(gmt8.getMonth() + 1);\n  const year = String(gmt8.getFullYear()).slice(-2);\n\n  return `${hours}.${minutes} ${day}-${month}-${year}`;\n}\n\nconst out = items.map(({ json }) => {\n  const title = json.Name ?? json.name ?? json.Title ?? json.title ?? \"\";\n  const pageId = json.page_id ?? json.id ?? \"\";\n  const html = json.content ?? json.content_html ?? \"\";\n  const givenSlug = json.Slug ?? json.slug ?? \"\";\n  const created = json.created ?? json.created_time ?? \"\";\n  const edited = json[\"Last edited time\"] ?? json.last_edited_time ?? \"\";\n  const categories = json.categories ?? [];\n  const tags = json.Tags ?? json.tags ?? [];\n  const image = json.Image ?? json.image ?? [];\n\n  const slug = givenSlug && givenSlug.trim() ? givenSlug : slugify(title);\n  const pageIdNoHyphens = String(pageId || \"\").replace(/-/g, \"\");\n  const url = slug && pageIdNoHyphens ? `https://www.notion.so/${slug}-${pageIdNoHyphens}` : undefined;\n\n  let excerpt = json.excerpt ?? \"\";\n  if (!excerpt || !excerpt.trim()) {\n    const txt = firstParagraphText(html);\n    excerpt = txt.length > 200 ? `${txt.slice(0, 200).trim()}â€¦` : txt;\n  }\n\n  const author = (json.Author && json.Author.length > 0) ? json.Author : [\"Sultan\"];\n  const contributor = (json.Contributor && json.Contributor.length > 0) ? json.Contributor : [\"Goks\"];\n\n  const metadata = {\n    title: title,\n    page_id: pageId || undefined,\n    slug: slug || undefined,\n    excerpt: excerpt || undefined,\n    categories: Array.isArray(categories) ? categories : (categories ? [categories] : []),\n    tags: Array.isArray(tags) ? tags : (tags ? [tags] : []),\n    image,\n    created_time: formatDateGMT8(created),\n    last_edited_time: edited,\n    url,\n    author,\n    contributor,\n    \n  };\n\n  Object.keys(metadata).forEach(k => metadata[k] === undefined && delete metadata[k]);\n\n  return { json: { metadata, content: html || \"\" } };\n});\n\nreturn out;\n"       },       "type": "n8n-nodes-base.code",       "typeVersion": 2,       "position": [         -560,         -176       ],       "id": "891eae33-dee7-46ed-9806-2c5d0c087461",       "name": "Final Content",       "alwaysOutputData": true     },     {       "parameters": {         "mode": "combine",         "fieldsToMatchString": "page_id",         "options": {}       },       "type": "n8n-nodes-base.merge",       "typeVersion": 3.2,       "position": [         -896,         -176       ],       "id": "a9f00f83-8264-4232-96c2-4d697e06f9da",       "name": "Merge"     },     {       "parameters": {         "jsCode": "// Extract metadata from Notion page\nconst allItems = $input.all();\n\nreturn allItems.map(item => {\n  const props = item.json.properties || {};\n  \n  // Extract title\n  let title = 'Untitled';\n  if (props.Name && props.Name.type === 'title' && props.Name.title.length > 0) {\n    title = props.Name.title[0].text?.content || 'Untitled';\n  }\n  \n  // Create slug from title\n  const slug = title\n    .toLowerCase()\n    .replace(/[^\w\s-]/g, '')\n    .trim()\n    .replace(/\s+/g, '-');\n  \n  // Extract excerpt\n  let excerpt = '';\n  if (props.excerpt && props.excerpt.type === 'rich_text' && props.excerpt.rich_text.length > 0) {\n    excerpt = props.excerpt.rich_text\n      .map(t => t.plain_text || '')\n      .join('')\n      .trim()\n      .slice(0, 200);\n  }\n  \n  // Extract categories\n  let categories = [];\n  if (props.categories && props.categories.type === 'multi_select') {\n    categories = props.categories.multi_select.map(cat => cat.name);\n  }\n\n  // Extract tags\n  let tags = [];\n  if (props.Tags && props.Tags.type === 'multi_select') {\n    tags = props.Tags.multi_select.map(cat => cat.name);\n  }\n  \n  // Extract publish date\n  let publishDate = new Date().toISOString();\n  if (props.published_date && props.published_date.type === 'date' && props.published_date.date) {\n    publishDate = props.published_date.date.start;\n  }\n  \n  return {\n    json: {\n      page_id: item.json.id,\n      title,\n      slug,\n      excerpt,\n      categories,\n      tags,\n      publishDate,\n      url: item.json.url,\n      created_time: item.json.created_time,\n      last_edited_time: item.json.last_edited_time\n    }\n  };\n});"       },       "type": "n8n-nodes-base.code",       "typeVersion": 2,       "position": [         -1264,         -192       ],       "id": "2f4be86c-5cf3-422c-9de9-8441bf19678c",       "name": "Extract Metadata",       "onError": "continueRegularOutput"     },     {       "parameters": {         "conditions": {           "options": {             "caseSensitive": true,             "leftValue": "",             "typeValidation": "loose",             "version": 3           },           "conditions": [             {               "id": "0bca7655-cbeb-4ddf-b125-96611b8a0c4c",               "leftValue": "=",               "rightValue": "Blog",               "operator": {                 "type": "array",                 "operation": "contains",                 "rightType": "any"               }             }           ],           "combinator": "and"         },         "looseTypeValidation": true,         "options": {}       },       "type": "n8n-nodes-base.if",       "typeVersion": 2.3,       "position": [         -1856,         -128       ],       "id": "6483482f-688a-452b-bd6a-e8b8a24e5478",       "name": "If"     }   ],   "connections": {     "Notion Trigger1": {       "main": [         [           {             "node": "If",             "type": "main",             "index": 0           }         ]       ]     },     "Get Page Blocks": {       "main": [         [           {             "node": "Notion Block Extract",             "type": "main",             "index": 0           }         ]       ]     },     "Notion Block Extract": {       "main": [         [           {             "node": "Merge",             "type": "main",             "index": 1           }         ]       ]     },     "Get Database Pages": {       "main": [         [           {             "node": "Get Page Blocks",             "type": "main",             "index": 0           },           {             "node": "Extract Metadata",             "type": "main",             "index": 0           }         ]       ]     },     "Final Content": {       "main": [         [           {             "node": "Create GitHub File",             "type": "main",             "index": 0           }         ]       ]     },     "Merge": {       "main": [         [           {             "node": "Final Content",             "type": "main",             "index": 0           }         ]       ]     },     "Extract Metadata": {       "main": [         [           {             "node": "Merge",             "type": "main",             "index": 0           }         ]       ]     },     "If": {       "main": [         [           {             "node": "Get Database Pages",             "type": "main",             "index": 0           }         ],         []       ]     }   },   "pinData": {},   "meta": {     "templateCredsSetupCompleted": true,     "instanceId": "80f7ead35441eff617b54af2b6bc38f765701c5c328e48d5c1e57368724e4256"   } }